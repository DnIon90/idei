<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Foaie Pontaj cu Login</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f0f0; padding:20px; }
h1,h2 { color:#2e7d32; }
input,button { padding:6px; margin:5px 0; border-radius:4px; border:1px solid #ccc; width:100%; max-width:200px; }
button { background:#2e7d32; color:white; border:none; cursor:pointer; }
button:hover { background:#1b5e20; }
#login-area,#pontaj-area { margin-bottom:20px; }
table { border-collapse: collapse; margin-top:20px; background:white; width:100%; max-width:700px; }
th, td { border:1px solid #ccc; padding:6px 12px; text-align:center; }
th { background:#2e7d32; color:white; }
#total { margin-top:10px; font-weight:bold; }
.muted { font-size:13px; color:#666; }
.edit-btn, .delete-btn { padding:3px 6px; margin:0 2px; border-radius:3px; font-size:12px; }
.edit-btn { background:#ff9800; color:white; border:none; cursor:pointer; }
.edit-btn:hover { background:#f57c00; }
.delete-btn { background:#d32f2f; color:white; border:none; cursor:pointer; }
.delete-btn:hover { background:#b71c1c; }
</style>
</head>
<body>
<h1>Foaie Pontaj</h1>

<!-- LOGIN / REGISTER -->
<div id="login-area">
  <div id="not-logged">
    <input id="login-username" placeholder="Username"><br>
    <input id="login-password" placeholder="ParolÄƒ" type="password"><br>
    <button id="login-btn">LogheazÄƒ</button>
    <button id="show-register-btn">ÃŽnregistreazÄƒ</button>
    <div id="register-area" style="display:none;margin-top:10px;">
      <input id="reg-username" placeholder="Username"><br>
      <input id="reg-password" placeholder="ParolÄƒ" type="password"><br>
      <button id="register-btn">CreeazÄƒ cont</button>
      <button id="cancel-register">AnuleazÄƒ</button>
      <div id="reg-msg" class="muted"></div>
    </div>
  </div>
  <div id="logged" style="display:none;">
    <p class="muted">Logat ca <strong id="me-username"></strong></p>
    <button id="logout-btn">DeconecteazÄƒ</button>
  </div>
</div>

<!-- PONTAJ -->
<div id="pontaj-area" style="display:none;">
  <label>Data:</label>
  <input type="date" id="work-date">
  <label>Ore lucrate:</label>
  <input type="number" id="hours-worked" placeholder="Ex: 8" min="0">
  <label>Locul de muncÄƒ / Proiect:</label>
  <input type="text" id="work-place" placeholder="Ex: Birou / Proiect X">
  <label>Plata pe orÄƒ (â‚¬):</label>
  <input type="number" id="hourly-rate" placeholder="Ex: 10" min="0">
  <button onclick="addEntry()">AdaugÄƒ Zi</button>

  <h2>ðŸ“Š Pontaj</h2>
  <table>
    <thead>
      <tr>
        <th>#</th><th>Data</th><th>Ore lucrate</th><th>Locul de muncÄƒ</th><th>Plata pe orÄƒ (â‚¬)</th><th>Total (â‚¬)</th><th>AcÈ›iuni</th>
      </tr>
    </thead>
    <tbody id="timesheet-table"></tbody>
  </table>
  <div id="total">Total Plata: 0 â‚¬</div>
</div>

<script>
//=== Login / Register simplu cu hash ===
async function sha256Hex(str){
  const utf8=new TextEncoder().encode(str);
  const hash=await crypto.subtle.digest('SHA-256',utf8);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

const STORAGE_USERS='timesheet_users';
function loadUsers(){return JSON.parse(localStorage.getItem(STORAGE_USERS)||'{}');}
function saveUsers(u){localStorage.setItem(STORAGE_USERS,JSON.stringify(u));}

const loginUsername=document.getElementById('login-username');
const loginPassword=document.getElementById('login-password');
const loginBtn=document.getElementById('login-btn');
const showRegBtn=document.getElementById('show-register-btn');
const registerArea=document.getElementById('register-area');
const regUsername=document.getElementById('reg-username');
const regPassword=document.getElementById('reg-password');
const registerBtn=document.getElementById('register-btn');
const cancelRegister=document.getElementById('cancel-register');
const regMsg=document.getElementById('reg-msg');
const notLoggedDiv=document.getElementById('not-logged');
const loggedDiv=document.getElementById('logged');
const meUsernameEl=document.getElementById('me-username');
const logoutBtn=document.getElementById('logout-btn');
const pontajArea=document.getElementById('pontaj-area');

let currentUser=null;
let userData={timesheet:[]};

//=== Register / Login ===
showRegBtn.addEventListener('click',()=>{registerArea.style.display='block';});
cancelRegister.addEventListener('click',()=>{registerArea.style.display='none'; regMsg.textContent='';});

registerBtn.addEventListener('click', async () => {
  const u = regUsername.value.trim();
  const p = regPassword.value;
  if(!u||!p){regMsg.textContent='CompleteazÄƒ toate cÃ¢mpurile!'; return;}
  const users = loadUsers();
  if(users[u]){regMsg.textContent='Username deja folosit!'; return;}
  const hash = await sha256Hex(p);
  users[u] = {passHash: hash, timesheet: []};
  saveUsers(users);
  regMsg.textContent='Cont creat! PoÈ›i sÄƒ te loghezi.';
  regUsername.value=''; regPassword.value=''; registerArea.style.display='none';
});

loginBtn.addEventListener('click', async () => {
  const u = loginUsername.value.trim();
  const p = loginPassword.value;
  if(!u||!p){alert('CompleteazÄƒ username È™i parolÄƒ!'); return;}
  const users = loadUsers();
  if(!users[u]){alert('Utilizator inexistent!'); return;}
  const hash = await sha256Hex(p);
  if(hash!==users[u].passHash){alert('ParolÄƒ greÈ™itÄƒ!'); return;}
  currentUser=u;
  userData = JSON.parse(JSON.stringify(users[u]));
  localStorage.setItem('currentUser', currentUser);
  onLogin();
  loginUsername.value=''; loginPassword.value='';
});

logoutBtn.addEventListener('click',()=>{
  currentUser=null;
  localStorage.removeItem('currentUser');
  notLoggedDiv.style.display='block';
  loggedDiv.style.display='none';
  pontajArea.style.display='none';
});

window.onload = () => {
  const savedUser = localStorage.getItem('currentUser');
  const users = loadUsers();
  if(savedUser && users[savedUser]){
    currentUser=savedUser;
    userData = JSON.parse(JSON.stringify(users[savedUser]));
    onLogin();
  }
}

function onLogin(){
  notLoggedDiv.style.display='none';
  loggedDiv.style.display='block';
  pontajArea.style.display='block';
  meUsernameEl.textContent=currentUser;
  renderTimesheet();
}

//=== Pontaj ===
function loadTimesheet() { return userData.timesheet || []; }
function saveTimesheetData() {
  const users = loadUsers();
  users[currentUser].timesheet = userData.timesheet;
  saveUsers(users);
}

function addEntry() {
  const date = document.getElementById('work-date').value;
  const hours = parseFloat(document.getElementById('hours-worked').value) || 0;
  const place = document.getElementById('work-place').value.trim();
  const rate = parseFloat(document.getElementById('hourly-rate').value) || 0;

  if(!date || !hours || !place || !rate){ alert("CompleteazÄƒ toate cÃ¢mpurile!"); return; }

  const entry = { date, hours, place, rate, total: (hours*rate).toFixed(2) };
  userData.timesheet.push(entry);
  saveTimesheetData();
  renderTimesheet();

  document.getElementById('work-date').value='';
  document.getElementById('hours-worked').value='';
  document.getElementById('work-place').value='';
  document.getElementById('hourly-rate').value='';
}

function renderTimesheet(){
  const timesheet = loadTimesheet();
  const tbody = document.getElementById('timesheet-table');
  tbody.innerHTML='';
  let totalPayment = 0;
  timesheet.forEach((entry,index)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${index+1}</td>
                    <td>${entry.date}</td>
                    <td>${entry.hours}</td>
                    <td>${entry.place}</td>
                    <td>${entry.rate}</td>
                    <td>${entry.total}</td>
                    <td>
                      <button class="edit-btn" onclick="editEntry(${index})">EditeazÄƒ</button>
                      <button class="delete-btn" onclick="deleteEntry(${index})">È˜terge</button>
                    </td>`;
    tbody.appendChild(tr);
    totalPayment+=parseFloat(entry.total);
  });
  document.getElementById('total').textContent=`Total Plata: ${totalPayment.toFixed(2)} â‚¬`;
}

function deleteEntry(idx){
  if(confirm("Sigur vrei sÄƒ È™tergi aceastÄƒ Ã®nregistrare?")){